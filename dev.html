<!DOCTYPE html>
<html>
  <head>
	<title>PttChrome</title>
	  <link rel="icon" type="image/png" href="icon/logo.png" />

    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <link rel="stylesheet" type="text/css" href="css/bootstrap.min.css" />
    <link rel="stylesheet" type="text/css" href="css/main.css" />
    <link rel="stylesheet" type="text/css" href="css/color.css" />

    <link rel="chrome-webstore-item" href="https://chrome.google.com/webstore/detail/hhnlfapopmaimdlldbknjdgekpgffmbo">
    
    <script type="text/javascript" src="js/jquery-2.1.1.min.js"></script>
    <script type="text/javascript" src="js/bootstrap.min.js"></script>
    <script type="text/javascript" src="js/paramikojs_ssh.min.js"></script>

    <script type="text/javascript" src="https://apis.google.com/js/client.js?onload=handleGapiClientLoad"></script>
    <script type="text/javascript">
      var CLIENT_ID = '569657632946-i88sl1555v27jaji65nppshj7svopn2a.apps.googleusercontent.com';
      var SCOPES = [
          'https://www.googleapis.com/auth/drive.appfolder',
          'https://www.googleapis.com/auth/drive.appdata',
          // Add other scopes needed by your application.
        ];

      /**
       * Called when the client library is loaded.
       */
      function handleGapiClientLoad() {
        window.setTimeout(checkAuth, 1);
      }

      /**
       * Check if the current user has authorized the application.
       */
      function checkAuth() {
        gapi.auth.authorize(
            {'client_id': CLIENT_ID, 'scope': SCOPES.join(' '), 'immediate': true},
            handleAuthResult);
      }

      /**
       * Called when authorization server replies.
       *
       * @param {Object} authResult Authorization result.
       */
      function handleAuthResult(authResult) {
        var authorizeButton = document.getElementById('blacklist_driveAuthorize');
        var loadButton = document.getElementById('blacklist_driveLoad');
        var saveButton = document.getElementById('blacklist_driveSave');
        if (authResult && !authResult.error) {
          // Access token has been successfully retrieved, requests can be sent to the API
          authorizeButton.style.display = 'none';
          loadButton.style.display = '';
          saveButton.style.display = '';
          // good to call api
          gapi.client.load('drive', 'v2', function() {
            // optionally shows the loading complete icon
            listFilesInApplicationDataFolder(function(results) {
              console.log(results);
              for (var r in results) {
                var result = results[r];
                if (result.downloadUrl && result.title == 'blacklist') {
                  pttchrome.app.blacklistFileId = result.id;
                  break;
                }
              }
            });
          });
        } else {
          // No access token could be retrieved, force the authorization flow.
          authorizeButton.style.display = '';
          loadButton.style.display = 'none';
          saveButton.style.display = 'none';
          authorizeButton.onclick = handleAuthClick;
        }
      }
	  
      /**
      * update file in the Application Data folder. create new file if not exist
      *
      * @param {string} str String to store.
      * @param {Function} callback Function to call when the request is complete.
      */
      function updateFileInApplicationDataFolder(str, fileId, method, callback) {
        const boundary = '-------314159265358979323846';
        const delimiter = "\r\n--" + boundary + "\r\n";
        const close_delim = "\r\n--" + boundary + "--";

        var contentType = 'application/octet-stream';
        var metadata = {
          'title': 'blacklist',
          'mimeType': contentType,
          'parents': [{'id': 'appfolder'}]
        };

        // convert from string to base64 encoded data.
        var base64Data = btoa(str);
        var multipartRequestBody =
          delimiter +
          'Content-Type: application/json\r\n\r\n' +
          JSON.stringify(metadata) +
          delimiter +
          'Content-Type: ' + contentType + '\r\n' +
          'Content-Transfer-Encoding: base64\r\n' +
          '\r\n' +
          base64Data +
          close_delim;

        if (fileId) fileId = '/' + fileId;

        var request = gapi.client.request({
          'path': '/upload/drive/v2/files' + fileId,
          'method': method,
          'params': {'uploadType': 'multipart'},
          'headers': {
            'Content-Type': 'multipart/mixed; boundary="' + boundary + '"'
          },
          'body': multipartRequestBody});
        if (!callback) {
          callback = function(file) {
            console.log(file)
          };
        }
        request.execute(callback);
      }
      /**
      * Print a file's metadata.
      *
      * @param {String} fileId ID of the file to print metadata for.
      */
      function printFile(fileId) {
        var request = gapi.client.drive.files.get({
          'fileId': fileId
        });
        request.execute(function(resp) {
          console.log('Title: ' + resp.title);
          console.log('Description: ' + resp.description);
          console.log('MIME type: ' + resp.mimeType);
        });
      }

      function listFilesInApplicationDataFolder(callback) {
        var retrievePageOfFiles = function(request, result) {
          request.execute(function(resp) {
            result = result.concat(resp.items);
            var nextPageToken = resp.nextPageToken;
            if (nextPageToken) {
              request = gapi.client.drive.files.list({
                    'pageToken': nextPageToken
              });
              retrievePageOfFiles(request, result);
            } else {
              callback(result);
            }
          });
        }
        var initialRequest = gapi.client.drive.files.list({
          'q': '\'appfolder\' in parents'
        });
        retrievePageOfFiles(initialRequest, []);
      }

      /**
      * Download a file's content.
      *
      * @param {File} file Drive File instance.
      * @param {Function} callback Function to call when the request is complete.
      */
      function downloadFile(file, callback) {
        if (file.downloadUrl) {
          var accessToken = gapi.auth.getToken().access_token;
          var xhr = new XMLHttpRequest();
          xhr.open('GET', file.downloadUrl);
          xhr.setRequestHeader('Authorization', 'Bearer ' + accessToken);
          xhr.onload = function() {
            callback(xhr.responseText);
          };
          xhr.onerror = function() {
            callback(null);
          };
          xhr.send();
        } else {
          callback(null);
        }
      }
      
      function handleAuthClick(e) {
        gapi.auth.authorize(
            {'client_id': CLIENT_ID, 'scope': SCOPES, 'immediate': false}, 
            handleAuthResult);
        return false;
      }
    </script>

    <script type="text/javascript" src="js/app_conn.js"></script>
    <script type="text/javascript" src="js/predefined_config.js"></script>
    <script type="text/javascript" src="js/pref.js"></script>
    <script type="text/javascript" src="js/emoticon.js"></script>
    <script type="text/javascript" src="js/symbols.js"></script>
    <script type="text/javascript" src="js/input_helper.js"></script>
    <script type="text/javascript" src="js/ssh.js"></script>
    <script type="text/javascript" src="js/telnet.js"></script>
    <script type="text/javascript" src="js/b2u_table.js"></script>
    <script type="text/javascript" src="js/u2b_table.js"></script>
    <script type="text/javascript" src="js/term_buf.js"></script>
    <script type="text/javascript" src="js/term_view.js"></script>
    <script type="text/javascript" src="js/ansi_parser.js"></script>
    <script type="text/javascript" src="js/symbol_table.js"></script>
    <script type="text/javascript" src="js/pttchrome.js"></script>
    <script type="text/javascript" src="js/string_util.js"></script>
    <script type="text/javascript" src="js/i18n.js"></script>
    <script type="text/javascript" src="js/en_US_messages.js"></script>
    <script type="text/javascript" src="js/zh_TW_messages.js"></script>
    <script type="text/javascript" src="js/main.js"></script>
  </head>

  <body>
  <div id="fb-root"></div>
  <script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.0";
  fjs.parentNode.insertBefore(js, fjs);
  }(document, 'script', 'facebook-jssdk'));
  </script>
    <ul id="contextMenus" class="dropdown-menu" role="menu" style="display:none">
      <li id="cmenu_copy" class="cmenuItem contextSel"><a></a></li>
      <li id="cmenu_copyAnsi" class="cmenuItem contextSel"><a></a></li>
      <li id="cmenu_paste" class="cmenuItem contextNormal"><a></a></li>
      <li id="cmenu_searchGoogle" class="cmenuItem contextSel"><a></a></li>
      <li id="cmenu_openUrlNewTab" class="cmenuItem contextUrl"><a></a></li>
      <li id="cmenu_copyLinkUrl" class="cmenuItem contextUrl"><a></a></li>
      <li id="cmenu_divider1" class="divider"></li>
      <li id="cmenu_selectAll" class="cmenuItem contextNormal"><a></a></li>
      <li id="cmenu_mouseBrowsing" class="cmenuItem contextNormal"><a></a></li>
      <li id="cmenu_goToOtherSite" class="cmenuItem contextNormal"><a></a></li>
      <li id="cmenu_showInputHelper" class="cmenuItem contextNormal"><a></a></li>
      <li id="cmenu_addBlacklistUserId" class="cmenuItem"><a></a></li>
      <li id="cmenu_removeBlacklistUserId" class="cmenuItem"><a></a></li>
      <li id="cmenu_divider2" class="divider contextNormal"></li>
      <li id="cmenu_settings" class="cmenuItem"><a></a></li>
    </ul>

    <div id="BBSWindow" style="display:none">
      <input id="t" type="text" autocomplete="off" style="box-sizing:content-box; color:initial; border: none; width: 200px; height: 24px; position:absolute; left:-10000px; top:0px; z-index:2;resize: none; font-family:symmingliu,monospace;" autofocus/>
      <div id="cursor" class="terminal_display">_</div>
    </div> <!--BBSWindow end-->
    <div id="hideobj" style="display: none;">
      <span id="cmdHandler"></span>
      <select id="TrackKeyWordList">
      </select>
    </div>
    <div id="flashcontent" style="width:1px; height:1px; left:-10000px; top:-10000px;position: absolute;overflow: hidden;"></div>

    <div id="siteModal" class="modal fade" style="color:black;overflow-y:auto">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-body">
            <input type="text" class="form-control" ></input>
          </div>
        </div>
      </div>
    </div>

    <!--Preferences Modal-->
    <div id="prefModal" class="modal fade" style="color:black;overflow-y:auto">
      <div class="modal-dialog">
        <div class="modal-content">
          <div id="modalNav">
            <h3 id="opt_title">Settings</h3>

            <!-- Nav tabs -->
            <ul class="nav nav-pills nav-stacked" id="opt_tabs">
              <li><a id="optNav_general" href="#tabContentGeneral" name="general" data-toggle="pill">General</a></li>
              <li><a id="optNav_autologin" href="#tabContentAutologin" name="autologin" data-toggle="pill">Auto login</a></li>
              <li><a id="optNav_blacklist" href="#tabContentBlacklist" name="blacklist" data-toggle="pill">Blacklist</a></li>
              <li><a id="optNav_about" href="#tabContentAbout" name="about" data-toggle="pill">About</a></li>
            </ul>

            <button id="opt_reset" type="button" class="btn btn-default"></button>
          </div>
          <h3 id="modalHeader">General</h3>
          <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
          <div class="modal-body">

            <!-- Tab panes -->
            <div class="tab-content">

              <div class="tab-pane" id="tabContentGeneral">
                <div class="group">
                  <div class="list-group">
                    <div class="list-group-item-text">
                      <div id="opt_openInPackagedApp" class="checkbox">
                      </div>
                      <div id="opt_enablePicPreview" class="checkbox">
                      </div>
                      <div id="opt_enableNotifications" class="checkbox">
                      </div>
                      <div id="opt_enableEasyReading" class="checkbox">
                      </div>
                      <div id="opt_antiIdleTime" class="form-group">
                      </div>
                      <div id="opt_lineWrap" class="form-group">
                      </div>
                    </div>
                  </div>
                  <div class="list-group">
                    <h4 id="opt_mouseBrowsing" class="list-group-item-heading"></h4>
                    <div class="list-group-item-text">
                      <div id="opt_useMouseBrowsing" class="checkbox">
                      </div>
                      <div id="opt_mouseBrowsingHighlight" class="checkbox">
                      </div>
                      <div id="opt_mouseBrowsingHighlightColor">
                      </div>
                      <div id="opt_mouseLeftFunction" class="checkbox">
                      </div>
                      <div id="opt_mouseMiddleFunction" class="form-group">
                      </div>
                      <div id="opt_mouseWheelFunction1" class="form-group">
                      </div>
                      <div id="opt_mouseWheelFunction2" class="form-group">
                      </div>
                      <div id="opt_mouseWheelFunction3" class="form-group">
                      </div>
                    </div>
                  </div>
                </div>
                <div class="group">
                  <div class="list-group">
                    <h4 id="opt_appearance" class="list-group-item-heading"></h4>
                    <div class="list-group-item-text">
                      <div id="opt_fontFitWindowWidth" class="checkbox">
                      </div>
                      <div id="opt_fontFace" class="form-group">
                      </div>
                      <div id="opt_bbsMargin" class="form-group">
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <div class="tab-pane" id="tabContentAutologin">
                <div class="group">
                  <small id="opt_autologinWarning" style="color:red;"></small>
                  <div class="list-group">
                    <h4 id="opt_autologin" class="list-group-item-heading" style="margin-bottom:10px;"></h4>
                    <div class="list-group-item-text">
                      <div id="login_username" class="form-group"></div>
                      <div id="login_password" class="form-group"></div>
                    </div>
                  </div>
                </div>
              </div>

              <div class="tab-pane" id="tabContentBlacklist">
                <div id="opt_enableBlacklist" class="checkbox">
                </div>

                <div id="blacklist_driveSync" style="margin-bottom:10px">
                  <span>Use Google Drive to Sync:</span>
                  <a id="blacklist_driveAuthorize" class="btn btn-default">Login</a>
                  <a id="blacklist_driveLoad" class="btn btn-default">Load</a>
                  <a id="blacklist_driveSave" class="btn btn-default">Save</a>
                </div>

                <span id="opt_blacklistInstruction"></span>
                <!-- blacklist item start -->
                <textarea id="opt_blacklistedUsers" class="form-control"></textarea>
                <!-- blacklist item end -->
              </div>

              <div class="tab-pane" id="tabContentAbout">
                <div class="list-group">
                  <h4 class="list-group-item-heading">PttChrome <small>by <a href="mailto:yangchuck@gmail.com" target="_blank" rel="noreferrer">Chuck Yang</a></small></h4>
                  <a href='https://github.com/iamchucky/PttChrome' target="_blank" rel="noreferrer">https://github.com/iamchucky/PttChrome</a>
                  <div class="list-group-item-text" style="margin-top:10px;">
                    <a id="about_review" href="https://chrome.google.com/webstore/detail/pttchrome/hhnlfapopmaimdlldbknjdgekpgffmbo/reviews" target="_blank" rel="noreferrer" class="btn btn-default"></a>
                    <a id="about_feedback" href="mailto:pttchrome.feedback@gmail.com" target="_blank" rel="noreferrer" class="btn btn-default"></a>
                    <a id="about_fbpage" href="https://www.facebook.com/pttchrome" target="_blank" rel="noreferrer" class="btn btn-default"></a>
                  </div>
                </div>
                <div class="list-group">
                  <span id="about_promote" style="color:red;"></span>
                  <a href="https://chrome.google.com/webstore/detail/web2pttchrome/pjemnpgdmnlkkcpaddlnlegmdfpohnep" target="_blank" rel="noreferrer">Web2PttChrome</a>
                </div>
                <div class="list-group">
                  <h4 id="about_version_title" class="list-group-item-heading"></h4>
                  <div class="list-group-item-text">
                    <div id="about_version"></div>
                  </div>
                </div>
                <div class="list-group">
                  <h4 id="about_new_title" class="list-group-item-heading"></h4>
                  <div class="list-group-item-text">
                    <ul id="about_new">
                    </ul>
                  </div>
                </div>
              </div>

            </div>

          </div>
        </div>
      </div>
    </div>
    <div id="connectionAlert" class="alert alert-danger alert-dismissable fade in">
      <button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>
      <h4 id="connectionAlertHeader"></h4>
      <p id="connectionAlertText"></p>
      <p>
        <button id="connectionAlertReconnect" type"button" class="btn btn-danger"></button>
      </p>
    </div>
    <div id="welcomeJumbo">
      <div id="welcomeBanner">
        <div id="bigLogo"></div>
        <h1>踢踢控</h1>
        <br/>
        <h2 id="welcomeBannerPtt">Ptt</h2><h2 id="welcomeBannerChrome">Chrome</h2>
        <br/>
        <div id="getAppBtn" class="btn btn-default btn-lg">Get PttChrome from chrome web store</div>
      </div>
    </div>
    <img id="picPreview" src='' style='max-height:80%; max-width:90%'></img>
    <img id="picLoading" src='icon/connecting.gif' style="display:none; position:absolute; z-index:2"></img>

    <div id="inputHelper" class="modal-dialog">
      <div class="modal-content">

        <div class="modal-header">
          <button id="inputHelperClose" type="button" class="close"><span>&times;</span></button>
          <h4 class="modal-title">Modal title</h4>
        </div>

        <div class="modal-body">
          <ul id="inputHelperTabTitle" class="nav nav-pills nav-justified" role="tablist">
            <li class="active" id="colorsTabTitle">
              <a href="#colorHelperTab" role="tab" data-toggle="tab"></a>
            </li>

            <li class="dropdown" id="symbolsTabTitle">
              <a class="dropdown-toggle" data-toggle="dropdown">
              </a>
              <ul class="dropdown-menu" role="menu">
              </ul>
            </li>

            <li class="dropdown" id="emoticonsTabTitle">
              <a class="dropdown-toggle" data-toggle="dropdown">
              </a>
              <ul class="dropdown-menu" role="menu">
              </ul>
            </li>

          </ul>

          <div id="inputHelperTabContent" class="tab-content">
            <div id="colorHelperTab" class="tab-pane active" style="height:166px;">
              <ul id="colorHelperList">
                <li style="background-color:black" value="0"></li>
                <li class="b1" value="1"></li>
                <li class="b2" value="2"></li>
                <li class="b3" value="3"></li>
                <li class="b4" value="4"></li>
                <li class="b5" value="5"></li>
                <li class="b6" value="6"></li>
                <li class="b7" value="7"></li>
                <li class="b8" value="8"></li>
                <li class="b9" value="9"></li>
                <li class="b10" value="10"></li>
                <li class="b11" value="11"></li>
                <li class="b12" value="12"></li>
                <li class="b13" value="13"></li>
                <li class="b14" value="14"></li>
                <li class="b15" value="15"></li>
              </ul>
              <div align="center" style="color:#c0c0c0; background-color:black; height:38px; margin-bottom:10px; padding-top:8px;">
                <span id="colorHelperPreview" class="q7 b0">▅ PREVIEW ▅</span>
              </div>
              <div id="colorHelperBlink" class="checkbox">
              </div>
              <div class="btn-group dropdown" style="float:right">
                <button id="colorHelperSend" type="button" class="btn btn-default">Send</button>
                <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
                  <span class="caret"></span>
                </button>
                <ul id="colorHelperSendMenu" class="dropdown-menu" role="menu">
                  <li><a id="colorHelperSendMenuFore" type="foreground">Send foreground only</a></li>
                  <li><a id="colorHelperSendMenuBack" type="background">Send background only</a></li>
                  <li class="divider"></li>
                  <li><a id="colorHelperSendMenuReset" type="reset">Send reset code</a></li>
                </ul>
              </div>
            </div>
          </div>


        </div>

      </div> <!-- /.modal-content -->
    </div> <!-- /.modal-dialog -->
  </body>
</html>
